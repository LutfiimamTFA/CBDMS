{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the WorkWise application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "name": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "role": {
            "type": "string",
            "description": "The role of the user, determining their access level.",
            "enum": ["Super Admin", "Manager", "Employee", "Client"]
        },
        "companyId": {
            "type": "string",
            "description": "The ID of the company the user belongs to."
        }
      },
      "required": [
        "id",
        "name",
        "email",
        "role",
        "companyId"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task within the WorkWise application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Task entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the task."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the task."
        },
        "status": {
          "type": "string",
          "description": "The current status of the task (e.g., To Do, Doing, Done)."
        },
        "assigneeIds": {
          "type": "array",
          "description": "References to Users assigned to this task. (Relationship: Task N:N User)",
          "items": {
            "type": "string"
          }
        },
        "startDate": {
          "type": "string",
          "description": "The start date of the task.",
          "format": "date-time"
        },
        "dueDate": {
          "type": "string",
          "description": "The due date or deadline of the task.",
          "format": "date-time"
        },
        "priority": {
          "type": "string",
          "description": "The priority level of the task (e.g., Urgent, High, Normal, Low)."
        },
        "timeEstimate": {
          "type": "number",
          "description": "The estimated time in hours to complete the task."
        },
        "taskDependencyIds": {
          "type": "array",
          "description": "References to other Tasks that this Task depends on. (Relationship: Task 1:N Task)",
          "items": {
            "type": "string"
          }
        },
        "companyId": {
            "type": "string",
            "description": "The ID of the company this task belongs to, for client visibility."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "status",
        "assigneeIds",
        "startDate",
        "dueDate",
        "priority",
        "timeEstimate"
      ]
    },
    "TimeTracking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TimeTracking",
      "type": "object",
      "description": "Represents the time tracked for a specific task by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TimeTracking entity."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to the Task being tracked. (Relationship: Task 1:N TimeTracking)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who is tracking time. (Relationship: User 1:N TimeTracking)"
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the time tracking session.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The end time of the time tracking session.",
          "format": "date-time"
        },
        "duration": {
          "type": "number",
          "description": "The total duration of the time tracking session in hours."
        }
      },
      "required": [
        "id",
        "taskId",
        "userId",
        "startTime",
        "endTime",
        "duration"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles, including their role and company.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "A global collection of tasks. Access is controlled by roles and companyId.",
          "params": [
            {
              "name": "taskId",
              "description": "The unique identifier for the task."
            }
          ]
        }
      },
      {
        "path": "/tasks/{taskId}/timeTracking/{timeTrackingId}",
        "definition": {
          "entityName": "TimeTracking",
          "schema": {
            "$ref": "#/backend/entities/TimeTracking"
          },
          "description": "Stores time tracking entries for a specific task.",
          "params": [
            {
              "name": "taskId",
              "description": "The unique identifier for the task."
            },
            {
              "name": "timeTrackingId",
              "description": "The unique identifier for the time tracking entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is updated to support Role-Based Access Control (RBAC). The User entity now includes a `role` and `companyId`. The Task collection is now a root-level collection `/tasks` to allow more flexible, role-based queries (e.g., a Manager listing all tasks for their company) which is difficult with nested collections. Security rules will be heavily relied upon to enforce who can see which tasks, based on their role, companyId, and assignee."
  }
}
